<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kb.keyboard.warrior.dao.AlertDao">

	<select id="getAlert" resultType="kb.keyboard.warrior.dto.AlertDTO">
		SELECT * 
		FROM alert a
		JOIN alertSetting s 
		ON a.userno = s.userno
		WHERE a.userno = #{param1} and isread = '0'
		AND (
		    (a.category = 'like' AND s.like = '1') OR
		    (a.category = 'comment' AND s.comment = '1') OR
		    (a.category = 'notice' AND s.notice = '1') OR
		    (a.category = 'subscribe' AND s.subscribe = '1') OR
		    (a.category = 'follow' AND s.follow = '1') OR
		    (a.category = 'calendar' AND s.calendar = '1')
		);
		
<!-- 		select * from alert where userno = #{param1} and isread = 0; -->
	</select>
	<update id="updateIsread" >
		UPDATE alert SET isread = 1 WHERE alertid = #{param1};
	</update>
	<insert id="addNoticeAlert" parameterType="kb.keyboard.warrior.dto.AlertDTO">
		insert into alert (userno, message, category)
		values (#{userno}, #{message}, 'notice')
	</insert>
	<insert id="addWikiAlert" parameterType="kb.keyboard.warrior.dto.AlertDTO">
		insert into alert (userno, message, category, detail)
		values (#{userno}, #{message}, 'wiki', #{detail})
	</insert>
	<insert id="addCommentAlert" parameterType="kb.keyboard.warrior.dto.AlertDTO">
		insert into alert (userno, message, category, detail)
		values (#{userno}, #{message}, 'wiki', #{detail})
	</insert>
	<insert id="addLikeAlert" parameterType="kb.keyboard.warrior.dto.AlertDTO">
		insert into alert (userno, message, category, detail)
		values (#{userno}, #{message}, 'like', #{detail})
	</insert>
	<select id="getRecentlyAlert" resultType="kb.keyboard.warrior.dto.AlertDTO">
		select * from alert where userno=#{param} and (category = 'comment' or category='like'or category='wiki') 
		order by senddate desc limit 10;
	</select>
	
	
	<!-- 팔로우 관련 추가 -->
	<select id="checkFollow" parameterType="kb.keyboard.warrior.dto.FollowDTO" resultType="kb.keyboard.warrior.dto.FollowDTO"> 
		select * from follow where userno = #{userno} and targetUserno = #{targetUserno}
	</select>
	<insert id="addFollow" parameterType="kb.keyboard.warrior.dto.FollowDTO"> 
		insert into follow (userno, targetUserno, status)
		values (#{userno}, #{targetUserno}, '1')
	</insert>
	<update id="changeFollowStatus" parameterType="kb.keyboard.warrior.dto.FollowDTO">
		 UPDATE follow 
		 SET status = #{status} 
		 WHERE followId = #{followId}
	</update>
	
	
	
	
</mapper>